<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrello - Premiata Erboristeria Ceccato</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:Arial,sans-serif;background:#f5f5f0;}

    .top-banner{
      display:flex;justify-content:space-between;align-items:center;
      background:#8B7355;padding:8px 20px;font-size:14px;color:#fff;
      flex-wrap:wrap;gap:10px;
    }
    .top-banner a{color:#f4d03f;text-decoration:none;font-weight:bold;}

    header{
      background:linear-gradient(135deg,#2d5016,#4a7c23);
      color:#fff;text-align:center;padding:20px;
    }
    header h1{font-family:'Brush Script MT',cursive;font-size:36px;margin:0;}

    .nav-container{
      display:flex;justify-content:center;gap:15px;padding:15px;
      background:#4a7c23;flex-wrap:wrap;
    }
    .nav-button{
      background:#f4d03f;border:none;padding:12px 18px;border-radius:30px;
      cursor:pointer;font-weight:bold;transition:.3s;
    }
    .nav-button:hover{background:#d4ac0d;transform:scale(1.05);}

    .cart-icon{
      position:fixed;top:20px;right:20px;background:#f4d03f;
      width:60px;height:60px;border-radius:50%;
      display:flex;justify-content:center;align-items:center;
      font-size:28px;cursor:pointer;
      box-shadow:0 4px 15px rgba(0,0,0,.2);
      z-index:1000;
    }
    .cart-count{
      position:absolute;top:-5px;right:-5px;width:24px;height:24px;
      background:#e74c3c;color:#fff;border-radius:50%;
      font-size:12px;display:flex;justify-content:center;align-items:center;
      font-weight:bold;
    }

    .cart-page{max-width:1100px;margin:30px auto;padding:0 15px;}
    .cart-header{
      background:#fff;padding:20px;border-radius:15px;
      box-shadow:0 6px 20px rgba(0,0,0,.1);
      margin-bottom:20px;text-align:left;
    }
    .cart-header h2{color:#2d5016;margin-bottom:6px;}
    #shippingNotice{margin-top:6px;}

    .cart-container{
      display:grid;
      grid-template-columns:1.6fr 1fr;
      gap:20px;
    }

    .cart-items,.cart-summary{
      background:#fff;border-radius:15px;padding:20px;
      box-shadow:0 6px 20px rgba(0,0,0,.1);
    }

    .cart-item{
      display:grid;
      grid-template-columns:70px 1fr 110px 150px;
      gap:15px;align-items:center;
      padding:15px 0;border-bottom:1px solid #eee;
    }
    .cart-item:last-child{border-bottom:none;}

    .item-image{
      width:70px;height:70px;border-radius:15px;background:#f5f5f0;
      display:flex;align-items:center;justify-content:center;
      font-size:34px;
    }
    .item-details h3{color:#2d5016;font-size:16px;margin-bottom:5px;}
    .item-details p{color:#666;font-size:13px;}
    .item-price{font-weight:900;color:#2d5016;text-align:right;}

    .quantity-control{display:flex;align-items:center;gap:8px;justify-content:flex-end;}
    .quantity-btn{
      background:#4a7c23;border:none;color:#fff;width:32px;height:32px;
      border-radius:10px;cursor:pointer;font-weight:900;font-size:18px;
      display:flex;align-items:center;justify-content:center;
    }
    .quantity-btn:active{transform:scale(.98);}
    .quantity-input{
      width:56px;padding:7px;text-align:center;
      border:1px solid #ddd;border-radius:10px;font-weight:800;
    }

    .summary-title{color:#2d5016;font-weight:900;margin-bottom:12px;font-size:18px;}
    .summary-row{display:flex;justify-content:space-between;margin:10px 0;color:#333;}
    .summary-row.total{
      font-weight:900;font-size:18px;color:#2d5016;
      border-top:1px solid #eee;padding-top:12px;margin-top:14px;
    }

    .checkout-btn{
      margin-top:15px;width:100%;
      background:#2d5016;color:#fff;border:none;padding:14px;
      border-radius:12px;cursor:pointer;font-weight:900;font-size:16px;
    }
    .checkout-btn:hover{background:#4a7c23;}

    .empty-cart{
      background:#fff;border-radius:15px;padding:40px 20px;text-align:center;
      box-shadow:0 6px 20px rgba(0,0,0,.1);
    }
    .empty-cart h3{color:#2d5016;margin-bottom:10px;}
    .empty-cart p{color:#666;margin-bottom:15px;}
    .empty-cart a{
      display:inline-block;background:#f4d03f;color:#2d5016;font-weight:900;
      padding:12px 18px;border-radius:999px;text-decoration:none;
    }

    @media (max-width:900px){
      .cart-container{grid-template-columns:1fr;}
      .cart-item{grid-template-columns:60px 1fr;gap:12px;}
      .item-price,.quantity-control{justify-content:flex-start;text-align:left;}
    }
    @media (max-width:700px){
      .cart-icon{top:auto;bottom:18px;right:18px;width:54px;height:54px;font-size:24px;}
    }
  </style>
</head>
<body>

  <div class="top-banner">
    <div>üì¶ Spedizione rapida | üí≥ Pagamenti sicuri</div>
    <div style="display:flex; gap:20px; align-items:center;">
      <a href="accedi.html">Registrati / Accedi</a>
    </div>
  </div>

  <header>
    <h1>üåø Premiata Erboristeria Ceccato</h1>
  </header>

  <div class="nav-container">
    <button class="nav-button" onclick="location.href='Premiata Erboristeria Ceccato.html'">üè† Home</button>
    <button class="nav-button" onclick="location.href='catalogo.html'">üõçÔ∏è Catalogo</button>
    <button class="nav-button" onclick="location.href='contattaci.html'">üìû Contattaci</button>
  </div>

  <div class="cart-icon" onclick="location.href='carrello.html'">
    üõí
    <div class="cart-count" id="cartCount">0</div>
  </div>

  <div class="cart-page">
    <div class="cart-header">
      <h2>üõí Il tuo carrello</h2>
      <p>Prodotti nel carrello: <strong id="itemCount">0</strong></p>
      <div id="shippingNotice"></div>
    </div>

    <div id="cartContainer" class="cart-container" style="display:none;">
      <div class="cart-items">
        <div id="cartItems"></div>
      </div>

      <div class="cart-summary">
        <div class="summary-title">Riepilogo</div>
        <div class="summary-row"><span>Subtotale</span><span id="subtotal">‚Ç¨0.00</span></div>
        <div class="summary-row"><span>Spedizione</span><span id="shipping">‚Ç¨0.00</span></div>

        <div class="summary-row total"><span>Totale</span><span id="total">‚Ç¨0.00</span></div>

        <button class="checkout-btn" onclick="showToast('Checkout: versione demo ‚úÖ')">Procedi al checkout</button>
      </div>
    </div>

    <div id="emptyCart" class="empty-cart">
      <h3>Il carrello √® vuoto</h3>
      <p>Aggiungi prodotti dalla home o dal catalogo.</p>
      <a href="Premiata Erboristeria Ceccato.html">Torna ai prodotti</a>
    </div>
  </div>

  <!-- ‚úÖ CARRELLO INTEGRATO (NO cart.js) -->
  <script>
    const CART_KEY = "ceccato_cart_v1";

    function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); }
    function saveCart(cart){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartCount(); }

    function updateCartCount(){
      const cart = getCart();
      const count = cart.reduce((s,p)=>s+(p.qty||0),0);
      const badge = document.getElementById("cartCount");
      if (badge) badge.textContent = count;
    }

    function showToast(msg){
      let t = document.getElementById("toast");
      if(!t){
        t = document.createElement("div");
        t.id = "toast";
        t.style.cssText =
          "position:fixed;left:50%;bottom:24px;transform:translateX(-50%);" +
          "background:rgba(45,80,22,.95);color:#fff;padding:12px 18px;" +
          "border-radius:999px;font-weight:900;font-size:14px;opacity:0;" +
          "pointer-events:none;transition:all .25s ease;z-index:9999;";
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.style.opacity = "1";
      t.style.transform = "translateX(-50%) translateY(-6px)";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>{
        t.style.opacity="0";
        t.style.transform="translateX(-50%) translateY(0)";
      }, 1400);
    }

    function eur(n){ return "‚Ç¨" + (Math.round(n*100)/100).toFixed(2); }

    function renderCart(){
      const cart = getCart();

      const itemsEl = document.getElementById("cartItems");
      const emptyEl = document.getElementById("emptyCart");
      const contEl  = document.getElementById("cartContainer");

      if (!itemsEl) return;

      if (!cart.length){
        if (contEl) contEl.style.display = "none";
        if (emptyEl) emptyEl.style.display = "block";
        document.getElementById("itemCount").textContent = "0";
        document.getElementById("subtotal").textContent = eur(0);
        document.getElementById("shipping").textContent = eur(0);
        document.getElementById("total").textContent = eur(0);
        updateCartCount();
        return;
      }

      if (contEl) contEl.style.display = "grid";
      if (emptyEl) emptyEl.style.display = "none";

      itemsEl.innerHTML = cart.map((p,i)=>{
        const qty = p.qty || 1;
        const price = p.price || 0;
        return `
          <div class="cart-item">
            <div class="item-image">${p.emoji || "üåø"}</div>
            <div class="item-details">
              <h3>${p.name || "Prodotto"}</h3>
              <p style="margin-top:8px;">
                <a href="javascript:void(0)" onclick="removeItem(${i})"
                   style="color:#e74c3c;font-weight:900;text-decoration:none;">Rimuovi</a>
              </p>
            </div>

            <div class="item-price">${eur(price)}</div>

            <div class="quantity-control">
              <button class="quantity-btn" onclick="decQty(${i})">‚àí</button>
              <input class="quantity-input" type="number" min="1" value="${qty}"
                     oninput="setQty(${i}, this.value)">
              <button class="quantity-btn" onclick="incQty(${i})">+</button>
            </div>
          </div>
        `;
      }).join("");

      const itemCount = cart.reduce((s,p)=>s+(p.qty||0),0);
      const subtotal  = cart.reduce((s,p)=>s+((p.price||0)*(p.qty||0)),0);

      // Spedizione: 5.90, gratis da 49‚Ç¨
      const freeThreshold = 49;
      const shippingRate = 5.90;
      const shipping = subtotal >= freeThreshold ? 0 : shippingRate;
      const total = subtotal + shipping;

      document.getElementById("itemCount").textContent = String(itemCount);
      document.getElementById("subtotal").textContent  = eur(subtotal);
      document.getElementById("shipping").textContent  = eur(shipping);
      document.getElementById("total").textContent     = eur(total);

      const notice = document.getElementById("shippingNotice");
      if (notice){
        if (shipping === 0){
          notice.innerHTML = `<p style="color:#2d5016;font-weight:900;font-size:13px;">‚úÖ Spedizione gratuita (da 49‚Ç¨)</p>`;
        } else {
          const missing = Math.max(0, freeThreshold - subtotal);
          notice.innerHTML = `<p style="color:#666;font-size:13px;">Aggiungi ${eur(missing)} per ottenere la spedizione gratuita.</p>`;
        }
      }

      updateCartCount();
    }

    function setQty(i, q){
      let cart = getCart();
      q = parseInt(q,10);
      if (!q || q < 1) q = 1;
      if (!cart[i]) return;
      cart[i].qty = q;
      saveCart(cart);
      renderCart();
    }

    function incQty(i){
      const cart = getCart();
      if (!cart[i]) return;
      cart[i].qty = (cart[i].qty || 1) + 1;
      saveCart(cart);
      renderCart();
    }

    function decQty(i){
      const cart = getCart();
      if (!cart[i]) return;
      cart[i].qty = Math.max(1, (cart[i].qty || 1) - 1);
      saveCart(cart);
      renderCart();
    }

    function removeItem(i){
      const cart = getCart();
      if (!cart[i]) return;
      cart.splice(i, 1);
      saveCart(cart);
      showToast("Rimosso dal carrello");
      renderCart();
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateCartCount();
      renderCart();
    });
  </script>

</body>
</html>
